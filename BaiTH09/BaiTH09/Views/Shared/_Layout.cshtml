@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Fahasa.com - Hệ thống đọc sách trực tuyến hàng đầu</title>

    <link href="@Url.Content("~/Content/bootstrap.min.css")" rel="stylesheet" />
    <link href="@Url.Content("~/Content/bootstrap-icons/bootstrap-icons.css")" rel="stylesheet">
    <link href="@Url.Content("~/Content/Site.css")" rel="stylesheet" />
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="@Url.Action("Index", "Home")">
                <i class="bi bi-book-half"></i> Fahasa.com
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto align-items-lg-center">
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("Index", "Home")" data-page="home">Trang chủ</a></li>
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("TimKiemNangCao", "Home")" data-page="timkiem">Tìm kiếm nâng cao</a></li>

                    @* LOGIC KIỂM TRA SESSION CHÍNH XÁC *@
                    @if (Session["HoTen"] != null)
                    {
                        // Đã đăng nhập: Hiển thị tên và Đăng xuất
                        <li class="nav-item">
                            <span class="nav-link text-warning">
                                <i class="bi bi-person-circle"></i> Xin chào, @Session["HoTen"]
                            </span>
                        </li>
                        <li class="nav-item">
                            @* Action DangXuat phải nằm trong Home Controller *@
                            <a class="nav-link" href="@Url.Action("DangXuat", "Home")" data-page="dangxuat">Đăng xuất</a>
                        </li>
                    }
                    else
                    {
                        // Chưa đăng nhập: Hiển thị Đăng ký và Đăng nhập
                        <li class="nav-item"><a class="nav-link" href="@Url.Action("DangKy", "Home")" data-page="dangky">Đăng ký</a></li>
                        <li class="nav-item"><a class="nav-link" href="@Url.Action("DangNhap", "Home")" data-page="dangnhap">Đăng nhập</a></li>
                    }
                    <li class="nav-item"><a class="nav-link" href="@Url.Action("Contact", "Home")" data-page="contact">Liên hệ</a></li>

                </ul>

                <div class="d-flex align-items-center">
                    @using (Html.BeginForm("Search", "Home", FormMethod.Get, new { @class = "d-flex search-form" }))
                    {
                        <input class="form-control" type="search" name="keyword" placeholder="Tìm kiếm sách, tác giả..." />
                        <button class="btn" type="submit"><i class="bi bi-search"></i></button>
                    }

                    <div class="lang-selector">
                        <button><i class="bi bi-globe"></i> Language</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row g-4">

            <aside class="col-md-3 col-lg-2 sidebar">
                <div class="menu-box chude-box">
                    @Html.Action("ChuDePartial", "Home")
                </div>

                <div class="menu-box nhaxb-box">
                    @Html.Action("NhaXuatBanPartial", "Home")
                </div>
            </aside>

            <section class="col-md-9 col-lg-10 content">
                <div id="bannerCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3000">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img src="@Url.Content("~/Content/Images/banner1.png")" class="banner-img" alt="Banner 1" />
                        </div>
                        <div class="carousel-item">
                            <img src="@Url.Content("~/Content/Images/banner2.jpg")" class="banner-img" alt="Banner 2" />
                        </div>
                        <div class="carousel-item">
                            <img src="@Url.Content("~/Content/Images/banner3.jpg")" class="banner-img" alt="Banner 3" />
                        </div>
                    </div>

                    <button class="carousel-control-prev" type="button" data-bs-target="#bannerCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#bannerCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>


                <div class="body-content">
                    @RenderBody()
                </div>
            </section>
        </div>
    </div>

    <footer class="footer">
        <div class="container-fluid">
            <p>
                Liên hệ Khoa Công nghệ Thông tin - Trường Đại học Công nghiệp Thực phẩm TP.HCM<br />
                Địa chỉ: 140 Lê Trọng Tấn, P.Tây Thạnh, Q.Tân Phú, TP.HCM
            </p>
        </div>
    </footer>

    <script src="@Url.Content("~/Scripts/jquery-3.7.0.min.js")"></script>

    <script>
        $(document).ready(function () {
            // Vấn đề 2: Active menu theo trang hiện tại
            var currentUrl = window.location.pathname.toLowerCase();

            // Xóa /Home/ nếu có
            currentUrl = currentUrl.replace('/home', '');

            // Xác định trang hiện tại dựa trên URL
            var currentPage = '';

            // --- Cập nhật logic kiểm tra URL (Chỉ kiểm tra Action) ---
            if (currentUrl.includes('/index') || currentUrl === '/') {
                currentPage = 'home';
            } else if (currentUrl.includes('/dangky')) {
                currentPage = 'dangky';
            } else if (currentUrl.includes('/dangnhap')) {
                currentPage = 'dangnhap';
            } else if (currentUrl.includes('/dangxuat')) {
                currentPage = 'dangxuat';
            } else if (currentUrl.includes('/timkiemnangcao')) {
                currentPage = 'timkiem';
            } else if (currentUrl.includes('/contact')) {
                currentPage = 'contact';
            }

            // Set active cho menu
            $('.nav-link').each(function () {
                var page = $(this).data('page');

                // Bỏ qua các mục không phải là liên kết hoặc đã đăng nhập
                if ($(this).hasClass('text-warning') || page === undefined) {
                    return;
                }

                if (page === currentPage) {
                    $(this).addClass('active');
                } else {
                    $(this).removeClass('active');
                }
            });
        });
    </script>

    @RenderSection("scripts", required: false)

    <script src="@Url.Content("~/Scripts/bootstrap.bundle.min.js")"></script>
</body>
</html>